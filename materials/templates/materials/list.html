{% extends 'materials/base.html' %}
{% load static %}

{% block content %}
<div class="search-container">
    <form id="search-form">
        <input type="text" name="q" placeholder="Search materials..." value="{{ request.GET.q|default_if_none:'' }}">

        <select name="category">
            <option value="">All Categories</option>
            {% for cat in categories %}
            <option value="{{ cat.id }}" {% if request.GET.category == cat.id|stringformat:"s" %}selected{% endif %}>
                {{ cat.name }}
            </option>
            {% endfor %}
        </select>

        <input type="number" name="min_rating" placeholder="Min rating" min="1" max="5" value="{{ request.GET.min_rating|default_if_none:'' }}">
        
        <button type="submit">Apply</button>
    </form>
</div>

<h2>Study Materials</h2>
<div id="results-container">
    <ul class="material-list">
        {% for material in page_obj %}
    <li class="material-item">
        <a href="{% url 'material-detail' material.pk %}">
            {% if material.preview_image %}
                <img src="{{ material.preview_image.url }}" alt="{{ material.title }} preview" style="width:100px; height:auto; vertical-align: middle; margin-right: 10px;">
            {% endif %}
            {{ material.title }} ({{ material.category }})
        </a>
        <span class="upload-info">
            Uploaded by {{ material.uploaded_by }} on {{ material.upload_date|date:"M d, Y" }}
        </span>
    </li>
{% empty %}
    <p>No materials found{% if request.GET.q %} matching "{{ request.GET.q }}"{% endif %}.</p>
{% endfor %}

    </ul>
</div>

<div class="pagination" id="pagination-container">
    <span class="step-links">
        {% if page_obj.has_previous %}
            <a href="?page=1{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}{% if request.GET.min_rating %}&min_rating={{ request.GET.min_rating }}{% endif %}">&laquo; first</a>
            <a href="?page={{ page_obj.previous_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}{% if request.GET.min_rating %}&min_rating={{ request.GET.min_rating }}{% endif %}">previous</a>
        {% endif %}

        <span class="current">
            Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}.
        </span>

        {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}{% if request.GET.min_rating %}&min_rating={{ request.GET.min_rating }}{% endif %}">next</a>
            <a href="?page={{ page_obj.paginator.num_pages }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}{% if request.GET.min_rating %}&min_rating={{ request.GET.min_rating }}{% endif %}">last &raquo;</a>
        {% endif %}
    </span>
</div>

<script src="{% static 'materials/js/material_search.js' %}"></script>
{% endblock %}
